---
title: "Assignment 1"
author: "Frances Bonafe"
output: pdf_document
date: "2024-10-04"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#Packages used
library(tidyverse)
conflicted::conflict_prefer("filter", "dplyr")
library(vegan)
library(ggplot2)
library(maps)
library(reshape2)
library(formatR)

knitr::opts_chunk$set(tidy.opts = list(width.cutoff = 50), tidy = TRUE) #Wraps code in code chunk
```

# Introduction

The Sciuridae family, or commonly known as squirrels, are rodents organized into five subfamilies with 300 species including flying squirrels, ground squirrels, and tree squirrels (de Abreu-Jr et al., 2020). Squirrels can be found in many different regions of the world and they are present in forest biomes. (de Abreu-Jr et al., 2020; Thorington et al., 2012). All around the globe, some species of squirrels also inhabit the green spaces in urban areas (Steele et al.,2020). They perform crucial tasks in grassland and forest ecosystems, specifically, as agents of pollination and dispersion of seeds (Thorington et al., 2012). Due to their ecological importance, conservation of squirrels should not be disregarded (Thorington et al., 2012). Using data from BOLD, this study aims to explore the geographic distribution of squirrels around the globe and discover which five countries did most squirrel samples from BOLD were acquired. To take this a little further, a comparison of the number of unique BINs and species, as well as species composition similarity, will be performed with data from five countries with the most samples. The answers to these questions are important for the identification of regions for biodiversity studies and conservation efforts.

```{r}
#Obtaining data and filtering

Sciu_BOLD <- read.csv(file = "/Users/francesbonafe/Desktop/BINF/BINF 6210 - Software Tools/Assignment 1/data/Sciuridae.csv", na.strings = c("", "NA")) #For easier removal of blanks while filtering data for later steps

dfSciu_data <- Sciu_BOLD[,c("bin_uri", "subfamily_name", "species_name", "lat", "country")] #To select data necessary to answer my questions
```

```{r}
#World Heat Map to show taxonomic distribution across the globe 

#Filtering data to only include country and the number of samples from that country and organize countries with most to least sample count
dfcountry_data <- dfSciu_data %>%
  group_by(country) %>%
  summarise(sample_count = n()) %>%
  arrange(desc(sample_count)) %>%
  na.omit(NA) %>% 
  filter(country != "Unrecoverable", 
         country != "Exception - Culture",
         country != "Exception - Zoological Park")

#Deremine which 5 countries have the most squirrel samples
head(dfcountry_data, 5)

#Load world map data
dfworld_coordinates <- map_data("world")

#Data exploration: Check if country names match between country_data$country and world_coordinates$region
(dfcountry_data$country %>% unique()) %in% (dfworld_coordinates$region %>% unique()) 

#If true, the country names match. If false, country name does not match. There will be missing data points in heat map if the country names does not match between the two data sets

#Data manipulation: Change country names from dfcountry_data to match region names from dfworld_coordinates
dfcountry_data <- dfcountry_data %>%
  mutate(country = recode(country, "United States" = "USA", "Cote d'Ivoire" = "Ivory Coast"))

#Assimilate sample_count data from dfcountry_data to dfworld_coordinates
dfheatmap_data <- dfworld_coordinates %>%
  left_join(dfcountry_data, by = c("region" = "country")) 

#Create the heat map
ggplot(dfheatmap_data, aes(x = long, y = lat, group = group)) + 
  geom_polygon(aes(fill = sample_count), color = "black") +
  labs(x = "Longitude",
       y = "Latitude",
       title = "Squirrel Sample Counts by Country",
       fill = "Sample Count") +
  theme_minimal() +
  scale_fill_gradient(low = "lightblue",
                      high = "darkblue",
                      na.value = "gray90")
```

```{r}
#Bar Graph with Number of BINs and Species by Country
#Compare number of unique BINs and species of the 5 most samples countries

#Data filtering to list the number of unique BINs and species for the top 5 countries with the most samples from dfcountry_data (Unites States, Mongolia, Russia, Canada and Mexico)
dfBIN_Spec <- dfSciu_data %>%
  group_by(country) %>%
  summarise(
    BINs = n_distinct(bin_uri),
    Species = n_distinct(species_name)) %>%
  na.omit(NA) %>%
  filter(country %in% c("United States", "Canada", "Russia", "Mongolia", "Mexico"))

#Reshaping data for easier plotting on graph
dfBIN_Spec <- dfBIN_Spec %>% 
  pivot_longer(!country, names_to = "Category", values_to = "Count")

#Create the bar plot
ggplot(dfBIN_Spec, aes(x = Count, y = reorder(country, Count), fill = Category)) +
  geom_bar(stat = "identity",
           position = "dodge",
           aes(linetype = Category),
           width = 0.8) +
  scale_fill_manual(values = c("Species" = "lightblue", "BINs" = "steelblue")) +
  labs(title = "Comparison of BINs and Species by Country",
       x = "Number of BINs/Species",
       y = "Country") +
  scale_x_continuous(breaks = seq(0, 25, by = 2)) +
  theme_minimal() +
  theme(legend.position = c(0.75, 0.1),
        legend.direction = "horizontal",
        legend.background = element_rect(fill = "white", color = "black"),
        legend.box.background = element_rect(color = "black"), 
        legend.title = element_blank())
```

```{r}
#Comparison of community similarity
#Compare species community similarity of the 5 countries with the most samples

#Filtering data to determine the number of samples of each species from Canada, United States, Russia, Mongolia and Mexico, and manipulating data for easier calculation of Bray-Curtis dissimilarity
dfcommunity <- dfSciu_data %>%
  group_by(country, species_name) %>%
  summarise(count = n()) %>%
  na.omit() %>%
  filter(country %in% c("Canada", "United States", "Russia", "Mongolia", "Mexico")) %>%
  pivot_wider(names_from = species_name, values_from = count, values_fill = 0) %>% #To reshape the data for easier use with vegdist()
  column_to_rownames(var = "country") #The country column is removed and country names become row names so all data is numerical and is easy to use for vegdist()

#Calculate the Bray-Curtis dissimilarity to determine the similarity of the species composition of each country
community_matrix <- vegdist(dfcommunity, method = "bray") %>% 
  print()

#Peform NMDS for easier visualization of similarities of difference between the countries
nmds_result <- metaMDS(community_matrix, k = 2) 

#Extract results from NMDS results, and these will become the coordinates for each country
dfnmds_data <- as.data.frame(scores(nmds_result))

#Creates a column in dfnmds_data with country names so each point in NMDS ordination will be linked back to the specific countries
dfnmds_data$country <- rownames(dfnmds_data)

#Make the NMDS plot
ggplot(dfnmds_data, aes(x = NMDS1, y = NMDS2, label = country)) +
  geom_point(size = 2.5, aes(color = country)) +
  scale_x_continuous(limits = c(-0.46, 0.65), breaks = seq(-0.5, 0.7, by = 0.1)) +
  geom_text(hjust = -0.2, size = 3.5) +
  labs(title = "NMDS Plot of Community Similarity",
       x = "Axis 1",
       y = "Axis 2",
       color = "Country") +
  theme(legend.position = "none")

```

# Results and Discussion

The world heat map shows the distribution of squirrels on the world map and which countries were heavily sampled. The world map shows that squirrels are present across North America, Europe and most of Asia, with only a few countries on the southern hemisphere having samples.The five countries with the most squirrel samples are USA, Mongolia, Russia, Canada, and Mexico. This may implicate that the squirrel species richness in these countries are high. However, this may also indicate incomplete sampling from other countries where the population of squirrels are low.

The bar graph compares the number of unique species and BINs of squirrels present in USA, Mongolia, Russia, Canada, and Mexico. The graph shows that the United States contains the most species and BINs of squirrels, followed by Canada, Russia, Mexico, then lastly, Mongolia. The graph indicates that in United States, Canada and Russia, there are more recorded BINs than species. This may indicate that there are cryptic species, or species that are genetically distinct but morphologically very similar, within these countries or some squirrels found in these countries express genetic variation within their own species.

The NMDS plot compares the community similarity of squirrels in USA, Mongolia, Russia, Canada, and Mexico. The graph shows that Canada and United States, and Russia and Mongolia have a very similar community composition. However, the community between Canada/United States, and Russia/Mongolia are very different. These results were expected because if the countries are geographically closer together, it makes sense that the community similarity is higher. It is also expected that countries that are geographically separated or further will exhibit great community dissimilarity. Lastly, the community composition of Mexico is dissimilar from the other countries, indicating that Mexico has a unique squirrel species composition. This result was unexpected because Mexico is geographically close to the United States, and it was expected that they will share some degree of similarity. However, the results shows that the squirrel community of United States and Mexico are very dissimilar. The reason could be a physical barrier that prevents the interaction of squirrels between United States and Mexico, enabling a unique squirrel community to form in Mexico.

Although the dataset for Sciuridae from BOLD is large, many sampling information such as countries, latitude and longitude. Also, some countries were heavily sampled, while some had very few, so species richness results may be biased and not accurately depict the diversity of squirrel species in that region. For future studies, sampling from countries with few samples is required as well as ensuring that sampling information is included for every sample to avoid biases.

# Acknowledgements

I want to thank Derick Liang and Vivian Phung for the idea of making a world map, Derick Liang for teaching me how to use R Markdown, Rebecca Choi for assisting me in data organization and suggesting in making a heat map on the world map, and Karl Cottonie for guiding me with fixing the issues with my data points for the world heat map. I would also like to acknowldge ChatGPT who provided command instructions and clarifications, as well as asstitance in troubleshooting.

# References

de Abreu-Jr, E. F., Pavan, S. E., Tsuchiya, M. T. N., Wilson, D. E., Percequillo, A. R., & Maldonado, J. E. (2020). Museomics of tree squirrels: a dense taxon sampling of mitogenomes reveals hidden diversity, phenotypic convergence, and the need of a taxonomic overhaul. BMC Ecology and Evolution, 20(1), 1–77. <https://doi.org/10.1186/s12862-020-01639-y>

Steele, M. A., & Yi, X. (2020). Squirrel-seed interactions: The evolutionary strategies and impact of squirrels as both seed predators and seed dispersers. Frontiers in Ecology and Evolution, 8. <https://doi.org/10.3389/fevo.2020.00259>

Thorington, R.W., Koprowski, J. L., Steele, M. A., Whatton, J. F.(2012). Squirrels of the world. John Hopkind University Press.
